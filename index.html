<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>学生信息管理中心</title>
    <script src="../lib/node_modules/_vue@2.6.12@vue/dist/vue.js"></script>
    <script src="../lib/node_modules/_axios@0.21.1@axios/dist/axios.js"></script>
    <style type="text/css">
        .pageList a {
            padding: 3px 8px;
            text-decoration: none;
            margin: 0px 3px;
            border: 1px solid #ccc;
        }

        .pageList a:hover {
            color: red;
            background-color: #99cc00;
        }

        .pageList span {
            padding: 3px 8px;
        }
    </style>
</head>

<body>
    <div id="app">
        <div style="text-align:center;padding-bottom: 10px;">
            <h2>学生信息管理中心</h2>
            <a href="./add.php">添加学生</a>
            共有<font color=red>
                {{studentNum}}
            </font>个学生信息
        </div>
        <table width="600" border="1" align="center" rules="all" cellpadding="5">
            <tr bgcolor='#ccc'>
                <th>编号</th>
                <th>姓名</th>
                <th>性别</th>
                <th>年龄</th>
                <th>学历</th>
                <th>工资</th>
                <th>奖金</th>
                <th>籍贯</th>
                <th>操作选项</th>
            </tr>
            <tr v-for="(student,i) in students">
                <td v-for="(studentValue,y) in students[i]"> {{studentValue}}</td>
                <td><a>修改</a> <a @click.prev="confirmDel(student.id)">删除</a></td>
            </tr>
            <tr>
                <td colspan="9" align="center" height="50" class="pageList">
                    <a v-for="pages in pagesValue" @click="load(pages)">
                        {{pages}}
                    </a>
                </td>
            </tr>
        </table>
    </div>
</body>
<script>
    var app = new Vue({
        el: "#app",
        data: {
            studentNum: 0,
            pagesSize: 0,
            pagesValue: [],
            checkPageIndex: 1,
            students: []
        },
        methods: {
            confirmDel(id) {
                //询问是否要删除？
                if (window.confirm("你真的要删除吗？")) {
                    //如果单击"确定"按钮，跳转到delete.php页面
                    location.href = "./delete.php?id=" + id;
                }
            },
            load(pagesIndex) {
                this.checkPageIndex = pagesIndex;
                let url = "./list.php?page=" + pagesIndex;
                axios.get(url).then(function (response) {
                    app.students = response.data.arr;
                    app.studentNum = response.data.records;
                    app.pagesSize = response.data.pagesize;
                    if (app.studentNum / app.pagesSize <= 10 || app.checkPageIndex < 6) {
                        console.log(1);
                        for (let i = 0; i < 10; i++) {
                            app.pagesValue[i] = i + 1;
                        }
                    } else if (app.checkPageIndex - 1 < app.studentNum / app.pagesSize - 4) {
                        console.log(2);
                        app.pagesValue[5] = app.checkPageIndex;
                        let start = 0;
                        let end = 6;
                        for (let j = 5; j > 0; j--) {
                            app.pagesValue[start] = app.checkPageIndex - j;
                            start++;
                        }

                        for (let j = 1; j < 5; j++) {
                            app.pagesValue[end] = app.checkPageIndex + j;
                            end++;
                        }

                    } else if (app.checkPageIndex > app.studentNum / app.pagesSize - 4) {
                        console.log(546546);
                        let start = 0;
                        for (let i = app.studentNum / app.pagesSize - 10; i < app.studentNum / app.pagesSize; i++) {
                            app.pagesValue[start] = i + 1;
                            start++;
                        }
                    }
                }).catch(
                    function () {
                        alert('数据获取失败');
                    }
                )
            },
        },
        created() {
            this.load(1);
        },
    })
</script>

</html>