<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>学生信息管理中心</title>
    <script src="../lib/node_modules/_vue@2.6.12@vue/dist/vue.js"></script>
    <script src="../lib/node_modules/_axios@0.21.1@axios/dist/axios.js"></script>
    <script src="../lib/node_modules/_jquery@3.5.1@jquery/dist/jquery.js"></script>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <div id="app">
        <div style="text-align:center;padding-bottom: 10px;">
            <h2>学生信息管理中心</h2>
            <a @click.prev="addTipShow()">添加学生</a>
            共有<font color=red>
                {{studentNum}}
            </font>个学生信息
        </div>
        <table width="600" border="1" align="center" rules="all" cellpadding="5">
            <tr style="background-color: #ccc;">
                <th>编号</th>
                <th>姓名</th>
                <th>性别</th>
                <th>年龄</th>
                <th>学历</th>
                <th>工资</th>
                <th>奖金</th>
                <th>籍贯</th>
                <th>操作选项</th>
            </tr>
            <tr v-for="(student,i) in students">
                <td v-for="(studentValue,y) in students[i]"> {{studentValue}}</td>
                <td><a @click.prev="upDateTipShow($event)">修改</a> <a @click.prev="confirmDel(student.id)">删除</a></td>
            </tr>
            <tr>
                <td colspan="9" align="center" height="50" class="pageList">
                    <a v-for="pages in pagesNum" @click="load(pages)">
                        {{pages}}
                    </a>
                </td>
            </tr>
        </table>
    </div>
    <div id="addTip" class="tip" v-show="display">
        <div id="cover"></div>
        <div class="tipBody">
            <div style="text-align:center;padding-bottom: 10px;">
                <h2>学生信息管理中心——添加学生</h2>
                <a @click.prev="addTipHide()">返回</a>
            </div>

            <form method="post" action="">
                <table width="400" bordercolor="#ccc" border="1" rules="all" align="center" cellpadding="5">
                    <tr>
                        <td width="80" align="right">姓名：</td>
                        <td><input type="text" name="name" v-model="formData.name"></td>
                    </tr>
                    <tr>
                        <td width="80" align="right">性别：</td>
                        <td>
                            <input type="radio" name="sex" value="男" v-model="formData.sex" checked>男
                            <input type="radio" name="sex" value="女" v-model="formData.sex">女
                        </td>
                    </tr>
                    <tr>
                        <td width="80" align="right">年龄：</td>
                        <td><input type="text" name="age" v-model="formData.age"></td>
                    </tr>
                    <tr>
                        <td width="80" align="right">学历：</td>
                        <td>
                            <select name="edu" v-model="formData.edu">
                                <option value="1">初中</option>
                                <option value="2">高中</option>
                                <option value="3" selected="selected">大专</option>
                                <option value="4">本科</option>
                                <option value="5">研究生</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td width="80" align="right">工资：</td>
                        <td><input type="text" name="salary" v-model="formData.salary"></td>
                    </tr>
                    <tr>
                        <td width="80" align="right">奖金：</td>
                        <td><input type="text" name="bonus" v-model="formData.bonus"></td>
                    </tr>
                    <tr>
                        <td width="80" align="right">籍贯：</td>
                        <td><input type="text" name="city" v-model="formData.city"></td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>
                            <input type="button" value="提交" @click="addStudentData()">
                            <input type="reset" value="重置">
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
    <div id="upDateTip" class="tip" v-show="display">
        <div id="cover"></div>
        <div class="tipBody">
            <div style="text-align:center;padding-bottom: 10px;">
                <h2>学生信息管理中心——修改学生信息</h2>
                <a @click.prev="upDateTipHide()">返回</a>
            </div>

            <form method="post" action="">
                <table width="400" bordercolor="#ccc" border="1" rules="all" align="center" cellpadding="5">
                    <tr>
                        <td width="80" align="right">姓名：</td>
                        <td><input type="text" name="name" v-model="formData.name"></td>
                    </tr>
                    <tr>
                        <td width="80" align="right">性别：</td>
                        <td>
                            <input type="radio" name="sex" value="男" v-model="formData.sex" checked>男
                            <input type="radio" name="sex" value="女" v-model="formData.sex">女
                        </td>
                    </tr>
                    <tr>
                        <td width="80" align="right">年龄：</td>
                        <td><input type="text" name="age" v-model="formData.age"></td>
                    </tr>
                    <tr>
                        <td width="80" align="right">学历：</td>
                        <td>
                            <select name="edu" v-model="formData.edu">
                                <option value="1">初中</option>
                                <option value="2">高中</option>
                                <option value="3" selected="selected">大专</option>
                                <option value="4">本科</option>
                                <option value="5">研究生</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td width="80" align="right">工资：</td>
                        <td><input type="text" name="salary" v-model="formData.salary"></td>
                    </tr>
                    <tr>
                        <td width="80" align="right">奖金：</td>
                        <td><input type="text" name="bonus" v-model="formData.bonus"></td>
                    </tr>
                    <tr>
                        <td width="80" align="right">籍贯：</td>
                        <td><input type="text" name="city" v-model="formData.city"></td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>
                            <input type="button" value="提交" @click="upDate()">
                            <input type="reset" value="重置">
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
</body>
<script>
    var app = new Vue({
        el: "#app",
        data: {
            studentNum: 0,
            pagesMax: 0,
            pagesNum: [],
            checkPageIndex: 1,
            students: []
        },
        methods: {
            confirmDel(id) {
                //询问是否要删除？
                if (window.confirm("你真的要删除吗？")) {
                    //如果单击"确定"按钮，跳转到delete.php页面
                    // location.href = "./delete.php?id=" + id;
                    let url = "./delete.php?id=" + id;
                    axios.get(url).then(function (response) {
                        if (response) {
                            alert("删除成功");
                            location.reload();
                        } else {
                            alert("删除失败");
                        }
                    });
                }
            },
            addTipShow() {
                addTip.display = true;
            },
            upDateTipShow(event) {
                upDateTip.display = true;
                for (const key in upDateTip.formData) {
                    upDateTip.formData[key] = this.students[key];
                }
                upDateTip.formData = Object.assign({}, this.students[$(event.target).parent().parent().index() - 1]);
            },
            load(pagesIndex) {
                this.checkPageIndex = pagesIndex;
                let url = "./list.php?page=" + pagesIndex;
                axios.get(url).then(function (response) {
                    app.students = response.data.arr;
                    app.studentNum = response.data.records;
                    app.pagesMax = response.data.pagesize;
                    if (app.studentNum / app.pagesMax <= 10 || app.checkPageIndex < 6) {
                        for (let i = 0; i < app.studentNum / app.pagesMax; i++) {
                            app.pagesNum[i] = i + 1;
                        }
                    } else if (app.checkPageIndex - 1 < app.studentNum / app.pagesMax - 4) {
                        app.pagesNum[5] = app.checkPageIndex;
                        let start = 0;
                        let end = 6;
                        for (let j = 5; j > 0; j--) {
                            app.pagesNum[start] = app.checkPageIndex - j;
                            start++;
                        }

                        for (let j = 1; j < 5; j++) {
                            app.pagesNum[end] = app.checkPageIndex + j;
                            end++;
                        }

                    } else if (app.checkPageIndex > app.studentNum / app.pagesMax - 4) {
                        let start = 0;
                        for (let i = app.studentNum / app.pagesMax - 10; i < app.studentNum / app.pagesMax; i++) {
                            app.pagesNum[start] = i + 1;
                            start++;
                        }
                    }
                }).catch(
                    function () {
                        alert('数据获取失败');
                    }
                )
            },
        },
        created() {
            this.load(1);
        },
    })
    var addTip = new Vue({
        el: "#addTip",
        data: {
            display: false,
            formData: {
                name: "",
                sex: "",
                age: "",
                edu: "",
                salary: "",
                bonus: "",
                city: ""
            }
        },
        methods: {
            addTipHide() {
                this.display = false;
            },
            addStudentData() {
                for (const key in this.formData) {
                    if (this.formData[key] === "") {
                        alert('请完整填写数据');
                        return;
                    }
                }
                axios.post("./add.php", this.formData).then(
                    function (response) {
                        //清空表格
                        for (const key in addTip.formData) {
                            addTip.formData[key] = "";
                        }
                        alert(response.data);
                        location.reload();
                    }
                )
            }
        }

    })
    var upDateTip = new Vue({
        el: "#upDateTip",
        data: {
            display: false,
            formData: {
                id: "",
                name: "",
                sex: "",
                age: "",
                edu: "",
                salary: "",
                bonus: "",
                city: ""
            }
        },
        methods: {
            upDateTipHide() {
                this.display = false;
            },
            upDate() {
                for (const key in this.formData) {
                    if (this.formData[key] === "") {
                        alert('请完整填写数据');
                        return;
                    }
                }
                axios.post("./update.php", this.formData).then(
                    function (response) {
                        //清空表格
                        for (const key in addTip.formData) {
                            upDateTip.formData[key] = "";
                        }
                        alert(response.data);
                        location.reload();
                    }
                )
            }
        }
    })
</script>

</html>